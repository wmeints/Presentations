(function(n,t){(function(i){typeof define=="function"&&define.amd?define(["jquery"],i):n.sammy=t.Sammy=i(n)})(function(n){var i,w="([^/]+)",h=/:([\w\d]+)/g,l=/\?([^#]*)?$/,u=function(n){return Array.prototype.slice.call(n)},r=function(n){return Object.prototype.toString.call(n)==="[object Function]"},f=function(n){return Object.prototype.toString.call(n)==="[object Array]"},a=function(n){return Object.prototype.toString.call(n)==="[object RegExp]"},o=function(n){return decodeURIComponent((n||"").replace(/\+/g," "))},v=encodeURIComponent,y=function(n){return String(n).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e=function(n){return function(){return this.route.apply(this,[n].concat(Array.prototype.slice.call(arguments)))}},c={},s=!!(t.history&&history.pushState),p=[];return i=function(){var t=u(arguments),f,e;return(i.apps=i.apps||{},t.length===0||t[0]&&r(t[0]))?i.apply(i,["body"].concat(t)):typeof(e=t.shift())=="string"?(f=i.apps[e]||new i.Application,f.element_selector=e,t.length>0&&n.each(t,function(n,t){f.use(t)}),f.element_selector!=e&&delete i.apps[e],i.apps[f.element_selector]=f,f):void 0},i.VERSION="0.7.2",i.addLogger=function(n){p.push(n)},i.log=function(){var t=u(arguments);t.unshift("["+Date()+"]"),n.each(p,function(n,r){r.apply(i,t)})},typeof t.console!="undefined"?r(t.console.log.apply)?i.addLogger(function(){t.console.log.apply(t.console,arguments)}):i.addLogger(function(){t.console.log(arguments)}):typeof console!="undefined"&&i.addLogger(function(){console.log.apply(console,arguments)}),n.extend(i,{makeArray:u,isFunction:r,isArray:f}),i.Object=function(t){return n.extend(this,t||{})},n.extend(i.Object.prototype,{escapeHTML:y,h:y,toHash:function(){var t={};return n.each(this,function(n,i){r(i)||(t[n]=i)}),t},toHTML:function(){var t="";return n.each(this,function(n,i){r(i)||(t+="<strong>"+n+"<\/strong> "+i+"<br />")}),t},keys:function(n){var i=[],t;for(t in this)r(this[t])&&n||i.push(t);return i},has:function(t){return this[t]&&n.trim(this[t].toString())!==""},join:function(){var n=u(arguments),t=n.shift();return n.join(t)},log:function(){i.log.apply(i,arguments)},toString:function(t){var i=[];return n.each(this,function(n,u){(!r(u)||t)&&i.push('"'+n+'": '+u.toString())}),"Sammy.Object: {"+i.join(",")+"}"}}),i.DefaultLocationProxy=function(n,t){this.app=n,this.is_native=!1,this.has_history=s,this._startPolling(t)},i.DefaultLocationProxy.fullPath=function(n){var t=n.toString().match(/^[^#]*(#.+)$/),i=t?t[1]:"";return[n.pathname,n.search,i].join("")},n.extend(i.DefaultLocationProxy.prototype,{bind:function(){var f=this,u=this.app,r=i.DefaultLocationProxy;if(n(t).bind("hashchange."+this.app.eventNamespace(),function(n,i){f.is_native!==!1||i||(f.is_native=!0,t.clearInterval(r._interval),r._interval=null),u.trigger("location-changed")}),s&&!u.disable_push_state){n(t).bind("popstate."+this.app.eventNamespace(),function(){u.trigger("location-changed")});n("a").on("click.history-"+this.app.eventNamespace(),function(n){if(!n.isDefaultPrevented()&&!n.metaKey&&!n.ctrlKey){var i=r.fullPath(this);if(this.hostname==t.location.hostname&&u.lookupRoute("get",i)&&this.target!=="_blank")return n.preventDefault(),f.setLocation(i),!1}})}r._bindings||(r._bindings=0),r._bindings++},unbind:function(){n(t).unbind("hashchange."+this.app.eventNamespace()),n(t).unbind("popstate."+this.app.eventNamespace()),n("a").off("click.history-"+this.app.eventNamespace()),i.DefaultLocationProxy._bindings--,i.DefaultLocationProxy._bindings<=0&&(t.clearInterval(i.DefaultLocationProxy._interval),i.DefaultLocationProxy._interval=null)},getLocation:function(){return i.DefaultLocationProxy.fullPath(t.location)},setLocation:function(n){if(/^([^#\/]|$)/.test(n)&&(n=s&&!this.app.disable_push_state?"/"+n:"#!/"+n),n!=this.getLocation())if(s&&!this.app.disable_push_state&&/^\//.test(n))history.pushState({path:n},t.title,n),this.app.trigger("location-changed");else return t.location=n},_startPolling:function(r){var f=this,u;i.DefaultLocationProxy._interval||(r||(r=10),u=function(){var r=f.getLocation();(typeof i.DefaultLocationProxy._last_location=="undefined"||r!=i.DefaultLocationProxy._last_location)&&t.setTimeout(function(){n(t).trigger("hashchange",[!0])},0),i.DefaultLocationProxy._last_location=r},u(),i.DefaultLocationProxy._interval=t.setInterval(u,r))}}),i.Application=function(n){var t=this;this.routes={},this.listeners=new i.Object({}),this.arounds=[],this.befores=[],this.namespace=(new Date).getTime()+"-"+parseInt(Math.random()*1e3,10),this.context_prototype=function(){i.EventContext.apply(this,arguments)},this.context_prototype.prototype=new i.EventContext,r(n)&&n.apply(this,[this]),this._location_proxy||this.setLocationProxy(new i.DefaultLocationProxy(this,this.run_interval_every)),this.debug&&this.bindToAllEvents(function(n,i){t.log(t.toString(),n.cleaned_type,i||{})})},i.Application.prototype=n.extend({},i.Object.prototype,{ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error","check-form-submission","redirect","location-changed"],_last_route:null,_location_proxy:null,_running:!1,element_selector:"body",debug:!1,raise_errors:!1,run_interval_every:50,disable_push_state:!1,template_engine:null,toString:function(){return"Sammy.Application:"+this.element_selector},$element:function(t){return t?n(this.element_selector).find(t):n(this.element_selector)},use:function(){var t=u(arguments),n=t.shift(),f=n||"";try{t.unshift(this),typeof n=="string"&&(f="Sammy."+n,n=i[n]),n.apply(this,t)}catch(e){typeof n=="undefined"?this.error("Plugin Error: called use() but plugin ("+f.toString()+") is not defined",e):r(n)?this.error("Plugin Error",e):this.error("Plugin Error: called use() but '"+f.toString()+"' is not a function",e)}return this},setLocationProxy:function(n){var t=this._location_proxy;this._location_proxy=n,this.isRunning()&&(t&&t.unbind(),this._location_proxy.bind())},log:function(){i.log.apply(i,Array.prototype.concat.apply([this.element_selector],arguments))},route:function(t,i){var f=this,o=[],e,s,u=Array.prototype.slice.call(arguments,2);if(u.length===0&&r(i)&&(i=t,u=[i],t="any"),t=t.toLowerCase(),i.constructor==String){for(h.lastIndex=0;(s=h.exec(i))!==null;)o.push(s[1]);i=new RegExp(i.replace(h,w)+"$")}return n.each(u,function(n,t){typeof t=="string"&&(u[n]=f[t])}),e=function(n){var t={verb:n,path:i,callback:u,param_names:o};f.routes[n]=f.routes[n]||[],f.routes[n].push(t)},t==="any"?n.each(this.ROUTE_VERBS,function(n,t){e(t)}):e(t),this},get:e("get"),post:e("post"),put:e("put"),del:e("delete"),any:e("any"),mapRoutes:function(t){var i=this;return n.each(t,function(n,t){i.route.apply(i,t)}),this},eventNamespace:function(){return["sammy-app",this.namespace].join("-")},bind:function(n,t,i){var r=this,u;return typeof i=="undefined"&&(i=t),u=function(){var t,u,n;t=arguments[0],n=arguments[1],n&&n.context?(u=n.context,delete n.context):u=new r.context_prototype(r,"bind",t.type,n,t.target),t.cleaned_type=t.type.replace(r.eventNamespace(),""),i.apply(u,[t,n])},this.listeners[n]||(this.listeners[n]=[]),this.listeners[n].push(u),this.isRunning()&&this._listen(n,u),this},trigger:function(n,t){return this.$element().trigger([n,this.eventNamespace()].join("."),[t]),this},refresh:function(){return this.last_location=null,this.trigger("location-changed"),this},before:function(n,t){return r(n)&&(t=n,n={}),this.befores.push([n,t]),this},after:function(n){return this.bind("event-context-after",n)},around:function(n){return this.arounds.push(n),this},onComplete:function(n){return this._onComplete=n,this},isRunning:function(){return this._running},helpers:function(t){return n.extend(this.context_prototype.prototype,t),this},helper:function(n,t){return this.context_prototype.prototype[n]=t,this},run:function(i){if(this.isRunning())return!1;var r=this;return n.each(this.listeners.toHash(),function(t,i){n.each(i,function(n,i){r._listen(t,i)})}),this.trigger("run",{start_url:i}),this._running=!0,this.last_location=null,/\#(.+)/.test(this.getLocation())||typeof i=="undefined"||this.setLocation(i),this._checkLocation(),this._location_proxy.bind(),this.bind("location-changed",function(){r._checkLocation()}),this.bind("submit",function(t){var i=r._checkFormSubmission(n(t.target).closest("form"));return i===!1?t.preventDefault():!1}),n(t).bind("unload",function(){r.unload()}),this.trigger("changed")},unload:function(){if(!this.isRunning())return!1;var t=this;return this.trigger("unload"),this._location_proxy.unbind(),this.$element().unbind("submit").removeClass(t.eventNamespace()),n.each(this.listeners.toHash(),function(i,r){n.each(r,function(n,r){t._unlisten(i,r)})}),this._running=!1,this},destroy:function(){return this.unload(),delete i.apps[this.element_selector],this},bindToAllEvents:function(t){var i=this;return n.each(this.APP_EVENTS,function(n,r){i.bind(r,t)}),n.each(this.listeners.keys(!0),function(r,u){n.inArray(u,i.APP_EVENTS)==-1&&i.bind(u,t)}),this},routablePath:function(n){return n.replace(l,"")},lookupRoute:function(n,t){var e=this,u=!1,i=0,f,r;if(typeof this.routes[n]!="undefined")for(f=this.routes[n].length;i<f;i++)if(r=this.routes[n][i],e.routablePath(t).match(r.path)){u=r;break}return u},runRoute:function(t,i,r,u){var s=this,f=this.lookupRoute(t,i),e,c,y,l,a,h,v,p;if(this.debug&&this.log("runRoute",[t,i].join(" ")),this.trigger("run-route",{verb:t,path:i,params:r}),typeof r=="undefined"&&(r={}),n.extend(r,this._parseQueryString(i)),f){this.trigger("route-found",{route:f}),(v=f.path.exec(this.routablePath(i)))!==null&&(v.shift(),n.each(v,function(n,t){f.param_names[n]?r[f.param_names[n]]=o(t):(r.splat||(r.splat=[]),r.splat.push(o(t)))})),e=new this.context_prototype(this,t,i,r,u),y=this.arounds.slice(0),l=this.befores.slice(0),h=[e],r.splat&&(h=h.concat(r.splat)),c=function(){for(var n,t,i;l.length>0;)if(a=l.shift(),s.contextMatchesOptions(e,a[0])&&(n=a[1].apply(e,[e]),n===!1))return!1;return s.last_route=f,e.trigger("event-context-before",{context:e}),typeof f.callback=="function"&&(f.callback=[f.callback]),f.callback&&f.callback.length&&(t=-1,i=function(){t++,f.callback[t]?n=f.callback[t].apply(e,h):s._onComplete&&typeof(s._onComplete==="function")&&s._onComplete(e)},h.push(i),i()),e.trigger("event-context-after",{context:e}),n},n.each(y.reverse(),function(n,t){var i=c;c=function(){return t.apply(e,[i])}});try{p=c()}catch(w){this.error(["500 Error",t,i].join(" "),w)}return p}return this.notFound(t,i)},contextMatchesOptions:function(t,i,r){var u=i,h,e,l,v,c,o,s;if((typeof u=="string"||a(u))&&(u={path:u}),typeof r=="undefined"&&(r=!0),n.isEmptyObject(u))return!0;if(f(u.path)){for(h=[],e=0,v=u.path.length;e<v;e+=1)l=n.extend({},u,{path:u.path[e]}),h.push(this.contextMatchesOptions(t,l));return c=n.inArray(!0,h)>-1?!0:!1,r?c:!c}return u.only?this.contextMatchesOptions(t,u.only,!0):u.except?this.contextMatchesOptions(t,u.except,!1):(o=!0,s=!0,u.path&&(a(u.path)||(u.path=new RegExp(u.path.toString()+"$")),o=u.path.test(t.path)),u.verb&&(s=typeof u.verb=="string"?u.verb===t.verb:u.verb.indexOf(t.verb)>-1),r?s&&o:!(s&&o))},getLocation:function(){return this._location_proxy.getLocation()},setLocation:function(n){return this._location_proxy.setLocation(n)},swap:function(n,t){var i=this.$element().html(n);return r(t)&&t(n),i},templateCache:function(n,t){return typeof t!="undefined"?c[n]=t:c[n]},clearTemplateCache:function(){return c={}},notFound:function(n,t){var i=this.error(["404 Not Found",n,t].join(" "));return n==="get"?i:!0},error:function(n,t){if(t||(t=new Error),t.message=[n,t.message].join(" "),this.trigger("error",{message:t.message,error:t}),this.raise_errors)throw t;else this.log(t.message,t)},_checkLocation:function(){var n,t;return n=this.getLocation(),this.last_location&&this.last_location[0]=="get"&&this.last_location[1]==n||(this.last_location=["get",n],t=this.runRoute("get",n)),t},_getFormVerb:function(t){var u=n(t),i,r;return r=u.find('input[name="_method"]'),r.length>0&&(i=r.val()),i||(i=u[0].getAttribute("method")),i&&i!==""||(i="get"),n.trim(i.toString().toLowerCase())},_checkFormSubmission:function(t){var i,r,f,u,e;return this.trigger("check-form-submission",{form:t}),i=n(t),r=i.attr("action")||"",f=this._getFormVerb(i),this.debug&&this.log("_checkFormSubmission",i,r,f),f==="get"?(u=this._serializeFormParams(i),u!==""&&(r+="?"+u),this.setLocation(r),e=!1):(u=n.extend({},this._parseFormParams(i)),e=this.runRoute(f,r,u,t.get(0))),typeof e=="undefined"?!1:e},_serializeFormParams:function(n){var r="",t=n.serializeArray(),i;if(t.length>0)for(r=this._encodeFormPair(t[0].name,t[0].value),i=1;i<t.length;i++)r=r+"&"+this._encodeFormPair(t[i].name,t[i].value);return r},_encodeFormPair:function(n,t){return v(n)+"="+v(t)},_parseFormParams:function(n){for(var i={},r=n.serializeArray(),t=0;t<r.length;t++)i=this._parseParamPair(i,r[t].name,r[t].value);return i},_parseQueryString:function(n){var r={},t,u,f,i;if(t=n.match(l),t&&t[1])for(u=t[1].split("&"),i=0;i<u.length;i++)f=u[i].split("="),r=this._parseParamPair(r,o(f[0]),o(f[1]||""));return r},_parseParamPair:function(n,t,i){return typeof n[t]!="undefined"?f(n[t])?n[t].push(i):n[t]=[n[t],i]:n[t]=i,n},_listen:function(n,t){return this.$element().bind([n,this.eventNamespace()].join("."),t)},_unlisten:function(n,t){return this.$element().unbind([n,this.eventNamespace()].join("."),t)}}),i.RenderContext=function(n){this.event_context=n,this.callbacks=[],this.previous_content=null,this.content=null,this.next_engine=!1,this.waiting=!1},i.RenderContext.prototype=n.extend({},i.Object.prototype,{then:function(n){var u,i;if(!r(n))if(typeof n=="string"&&n in this.event_context)u=this.event_context[n],n=function(n){return u.apply(this.event_context,[n])};else return this;return i=this,this.waiting?this.callbacks.push(n):(this.wait(),t.setTimeout(function(){var t=n.apply(i,[i.content,i.previous_content]);t!==!1&&i.next(t)},0)),this},wait:function(){this.waiting=!0},next:function(n){this.waiting=!1,typeof n!="undefined"&&(this.previous_content=this.content,this.content=n),this.callbacks.length>0&&this.then(this.callbacks.shift())},load:function(t,i,u){var f=this;return this.then(function(){var e,s,o;return(r(i)?(u=i,i={}):i=n.extend({},i),u&&this.then(u),typeof t=="string")?(o=t.match(/\.json$/)||i.json,e=o?i.cache===!0:i.cache!==!1,f.next_engine=f.event_context.engineFor(t),delete i.cache,delete i.json,i.engine&&(f.next_engine=i.engine,delete i.engine),e&&(s=this.event_context.app.templateCache(t)))?s:(this.wait(),n.ajax(n.extend({url:t,data:{},dataType:o?"json":"text",type:"get",success:function(n){e&&f.event_context.app.templateCache(t,n),f.next(n)}},i)),!1):t.nodeType?t.innerHTML:t.selector?(f.next_engine=t.attr("data-engine"),i.clone===!1?t.remove()[0].innerHTML.toString():t[0].innerHTML.toString()):void 0})},loadPartials:function(n){var t;if(n){this.partials=this.partials||{};for(t in n)(function(t,i){t.load(n[i]).then(function(n){this.partials[i]=n})})(this,t)}return this},render:function(n,t,i,u){return r(n)&&!t?this.then(n):(r(t)?(u=i,i=t,t=null):i&&!r(i)&&(u=i,i=null),this.loadPartials(u).load(n).interpolate(t,n).then(i))},partial:function(n,t,i,u){return r(i)?this.render(n,t,u).swap(i):r(t)?this.render(n,{},i).swap(t):this.render(n,t,i).swap()},send:function(){var t=this,n=u(arguments),i=n.shift();return f(n[0])&&(n=n[0]),this.then(function(){return n.push(function(n){t.next(n)}),t.wait(),i.apply(i,n),!1})},collect:function(t,i,u){var e=this,f=function(){r(t)&&(i=t,t=this.content);var u=[],f=!1;return n.each(t,function(n,t){var r=i.apply(e,[n,t]);return r.jquery&&r.length==1&&(r=r[0],f=!0),u.push(r),r}),f?u:u.join("")};return u?f():this.then(f)},renderEach:function(t,i,r,u){return f(i)&&(u=r,r=i,i=null),this.load(t).then(function(e){var o=this;if(r||(r=f(this.previous_content)?this.previous_content:[]),u)n.each(r,function(n,r){var f={},s=this.next_engine||t;i?f[i]=r:f=r,u(r,o.event_context.interpolate(e,f,s))});else return this.collect(r,function(n,r){var u={},f=this.next_engine||t;return i?u[i]=r:u=r,this.event_context.interpolate(e,u,f)},!0)})},interpolate:function(n,t,i){var r=this;return this.then(function(u,f){!n&&f&&(n=f),this.next_engine&&(t=this.next_engine,this.next_engine=!1);var e=r.event_context.interpolate(u,n,t,this.partials);return i?f+e:e})},swap:function(n){return this.then(function(t){return this.event_context.swap(t,n),t}).trigger("changed",{})},appendTo:function(t){return this.then(function(i){n(t).append(i)}).trigger("changed",{})},prependTo:function(t){return this.then(function(i){n(t).prepend(i)}).trigger("changed",{})},replace:function(t){return this.then(function(i){n(t).html(i)}).trigger("changed",{})},trigger:function(n,t){return this.then(function(i){return typeof t=="undefined"&&(t={content:i}),this.event_context.trigger(n,t),i})}}),i.EventContext=function(n,t,r,u,f){this.app=n,this.verb=t,this.path=r,this.params=new i.Object(u),this.target=f},i.EventContext.prototype=n.extend({},i.Object.prototype,{$element:function(){return this.app.$element(u(arguments).shift())},engineFor:function(n){var t=this,i;return r(n)?n:(n=(n||t.app.template_engine).toString(),(i=n.match(/\.([^\.\?\#]+)$/))&&(n=i[1]),n&&r(t[n]))?t[n]:t.app.template_engine?this.engineFor(t.app.template_engine):function(n){return n}},interpolate:function(n,t,i,r){return this.engineFor(i).apply(this,[n,t,r])},render:function(n,t,r,u){return new i.RenderContext(this).render(n,t,r,u)},renderEach:function(n,t,r,u){return new i.RenderContext(this).renderEach(n,t,r,u)},load:function(n,t,r){return new i.RenderContext(this).load(n,t,r)},loadPartials:function(n){return new i.RenderContext(this).loadPartials(n)},partial:function(n,t,r,u){return new i.RenderContext(this).partial(n,t,r,u)},send:function(){var n=new i.RenderContext(this);return n.send.apply(n,arguments)},redirect:function(){var t,i=u(arguments),l=this.app.getLocation(),o=i.length,e;if(o>1){for(var r=0,s=[],h=[],f={},c=!1;r<o;r++)typeof i[r]=="string"?s.push(i[r]):(n.extend(f,i[r]),c=!0);if(t=s.join("/"),c){for(e in f)h.push(this.app._encodeFormPair(e,f[e]));t+="?"+h.join("&")}}else t=i[0];this.trigger("redirect",{to:t}),this.app.last_location=[this.verb,this.path],this.app.setLocation(t),new RegExp(t).test(l)&&this.app.trigger("location-changed")},trigger:function(n,t){return typeof t=="undefined"&&(t={}),t.context||(t.context=this),this.app.trigger(n,t)},eventNamespace:function(){return this.app.eventNamespace()},swap:function(n,t){return this.app.swap(n,t)},notFound:function(){return this.app.notFound(this.verb,this.path)},json:function(t){return n.parseJSON(t)},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(" ")}}),i})})(jQuery,window);
//@ sourceMappingURL=sammy-0.7.2.min.js.map